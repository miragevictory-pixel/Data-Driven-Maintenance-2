<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maintenance Portal</title>
  <meta name="application-name" content="Maintenance Portal">
  <meta name="apple-mobile-web-app-title" content="Maintenance Portal">

  <style>
    :root{
      --brand:#9e2f1c;
      --bg:#fff9f7;
      --text:#1e1e1e;
      --muted:#6b6b6b;
      --card:#ffffff;
      --radius:18px;
      --shadow:0 6px 18px rgba(0,0,0,.12);
    }

    * , *::before, *::after{ box-sizing:border-box; }
    html,body{height:100%;}

    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "TH Sarabun New", Tahoma, sans-serif;
      color:var(--text);
      background:var(--bg);
      font-size:16px;
      line-height:1.5;
    }

    /* ====== Top Bar ====== */
    .topbar{
      position:sticky; top:0; z-index:20;
      background:var(--brand); color:#fff;
      padding:14px 18px;
      display:flex; align-items:center; gap:12px;
      box-shadow:0 2px 8px rgba(0,0,0,.15);
    }
    .topbar h1{
      font-size:20px;
      margin:0;
      font-weight:800;
      letter-spacing:.3px
    }
    .back{
  appearance:none;
  border:0;
  cursor:pointer;

  /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏°‡∏µ layer */
  width:40px;
  height:40px;
  border-radius:999px;

  display:grid;
  place-items:center;

  color:#fff;
  background: rgba(255,255,255,.14);          /* ‡∏ä‡∏±‡πâ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.18),    /* ‡∏Ç‡∏≠‡∏ö‡∏à‡∏≤‡∏á‡πÜ */
    0 6px 14px rgba(0,0,0,.18);               /* ‡πÄ‡∏á‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å */

  font-size:20px;
  line-height:1;

  transition: transform .08s ease, background .15s ease, box-shadow .15s ease;
}

.back:hover{
  background: rgba(255,255,255,.22);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.22),
    0 10px 20px rgba(0,0,0,.22);
  transform: translateY(-1px);
}

.back:active{
  transform: translateY(1px) scale(.98);      /* ‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏° */
  background: rgba(0,0,0,.12);
  box-shadow:
    inset 0 2px 8px rgba(0,0,0,.25),          /* ‡πÄ‡∏á‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏î */
    0 4px 10px rgba(0,0,0,.15);
}

.back:focus-visible{
  outline: none;
  box-shadow:
    0 0 0 3px rgba(255,255,255,.30),
    0 0 0 6px rgba(0,0,0,.12),
    inset 0 0 0 1px rgba(255,255,255,.22);
}


    /* ‚úÖ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏ô Desktop ‚Äú‡πÑ‡∏°‡πà‡πÄ‡∏•‡πá‡∏Å‚Äù */
    .container{
      max-width: 520px;
      margin:0 auto;
      padding: 22px 18px 78px;
    }
    @media (min-width: 640px){
      .container{ max-width: 920px; }
    }
    @media (min-width: 1024px){
      .container{
        max-width: 1240px;        /* üëà ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ï‡∏≤‡πÉ‡∏ô‡∏à‡∏≠ 16:9 */
        padding: 28px 26px 40px;
      }
    }

    /* ====== Views ====== */
    [data-view]{display:none}
    [data-view].active{display:block}

    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
      margin:18px 0;
    }
    .muted{color:var(--muted)}

    /* ====== Home ====== */
    .hero{ width:100%; text-align:center; margin: 18px 0 18px; }
    .hero span{
      font-size: 40px;
      font-weight: 900;
      color:var(--brand);
      letter-spacing:0.6px;
    }

    .big-img{
      width:100%;
      max-width:640px;
      margin: 14px auto 10px;
      display:block;
      opacity:.9
    }

    .menu{
      display:flex;
      flex-direction:column;
      gap:18px;
      margin-top:14px;
      max-width: 760px;     /* üëà ‡∏ó‡∏≥‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô PC */
      margin-left:auto;
      margin-right:auto;
    }

    .btn{
      display:block;
      width:100%;
      text-align:center;
      text-decoration:none;
      cursor:pointer;
      background:var(--brand);
      color:#fff;
      border:0;
      border-radius:999px;
      padding: 14px 22px;
      font-weight:900;
      box-shadow:0 4px 0 #5f1c11, var(--shadow);
      transition:transform .05s ease;
    }
    .btn small{
      display:block;
      font-weight:700;
      font-size: 15px;
      opacity:.92;
      margin-top:2px;
    }
    .btn:active{transform:translateY(1px)}

    /* ‡∏ó‡∏≥‡∏õ‡∏∏‡πà‡∏° Home ‡∏ö‡∏ô Desktop ‡∏î‡∏π‡πÄ‡∏ï‡πá‡∏°‡∏Ç‡∏∂‡πâ‡∏ô */
    @media (min-width: 1024px){
      .hero span{ font-size: 46px; }
      .btn{ padding: 16px 24px; font-size: 18px; }
      .btn small{ font-size: 16px; }
    }

    .link{color:var(--brand); font-weight:600; text-decoration:none}

    /* ====== Form (base) ====== */
    form{display:grid; gap:14px}
    .field{display:grid; gap:8px; position:relative}
    .field label{ font-weight:800; font-size:20px; line-height:1.35; }
    .field small{color:var(--muted)}
    .field input,.field select,.field textarea{
      width:100%;
      border-radius:12px;
      border:1px solid #ddd;
      padding:12px 12px;
      font-size:16px;
      background:#fff;
      outline-color:var(--brand);
    }
    .field textarea{min-height:96px; resize:vertical}

    .field[data-step]{ padding-left: 60px; }
    .field[data-step]::before{
      content: attr(data-step);
      position:absolute;
      left:20px;
      top:50%;
      transform:translateY(-50%);
      width:30px;
      height:30px;
      display:grid;
      place-items:center;
      background:var(--brand);
      color:#fff;
      border-radius:50%;
      font-weight:900;
      font-size:14px;
      box-shadow:var(--shadow);
    }

    /* ====== Status ====== */
    .kpi{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:12px;
      margin: 10px 0 14px;
    }
    .kpi .box{
      background:#fff;
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:16px 14px;
      text-align:center;
    }
    .kpi .box b{
      display:block;
      font-size:13px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .kpi .box span{
      font-size:28px;
      font-weight:900;
      color:var(--brand);
      line-height:1;
    }

    /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á: ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
    table{
      width:100%;
      border-collapse:collapse;
      font-size:15px;
      background:#fff;
      border-radius:14px;
      overflow:hidden;
    }
    th,td{
      padding:12px 12px;
      border-bottom:1px solid #eee;
      vertical-align:top
    }
    th{
      background:#fafafa;
      text-align:left;
      color:#444;
      font-weight:800;
      font-size:14px;
    }

    /* ‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏Ñ‡∏ö */
    [data-view="status"] .card{ overflow:auto; }

    /* ====== Footer Nav (mobile) ====== */
    .tabbar{
      position:fixed;
      bottom:14px; left:0; right:0;
      display:flex;
      justify-content:center;
      pointer-events:none
    }
    .tabbar .inner{
      pointer-events:auto;
      background:#fff;
      border-radius:999px;
      box-shadow:var(--shadow);
      display:flex;
      gap:8px;
      padding:8px
    }
    .chip{
      border-radius:999px;
      padding:8px 12px;
      border:1px solid #eee;
      background:#fff;
      font-weight:700;
      cursor:pointer;
      font-size:14px
    }
    .chip small{
      display:block;
      font-weight:500;
      font-size:11px;
      opacity:.85;
    }

    /* ====== Desktop: ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤ (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô report ‡∏ó‡∏µ‡πà‡∏à‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô) ====== */
    @media (min-width: 1024px){
      .tabbar{ display:none; } /* ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏á‡∏ö‡∏ô PC */

      /* ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤ status/guide/powerbi ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ */
      [data-view="status"] .card,
      [data-view="guide"] .card,
      [data-view="powerbi"] .card,
      [data-view="home"] .card{
        max-width: 1040px;
        margin-left:auto;
        margin-right:auto;
        padding: 26px;
      }

      /* Status: ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î */
      [data-view="status"] .card{ max-width: 1120px; }

      /* Guide: ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
      [data-view="guide"] .card{
        font-size:18px;
        line-height:1.7;
      }
      [data-view="guide"] h2{ font-size:24px; margin-bottom:14px; }
      [data-view="guide"] ol{ margin: 10px 0 0 18px; }
      [data-view="guide"] li{ margin: 10px 0; }

      /* PowerBI: ‡∏ó‡∏≥ iframe ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
      [data-view="powerbi"] h2{ font-size:24px; }
      [data-view="powerbi"] .muted{ font-size:16px; }
      [data-view="powerbi"] iframe{
        border-radius:14px;
      }
    }

    /* ====== Report form: ‡∏Ñ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏î‡∏¥‡∏° (‡πÅ‡∏ï‡πà‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏î‡∏µ‡∏ö‡∏ô Desktop) ====== */
    [data-view="report"] .card{
      max-width: 900px;
      margin-left:auto;
      margin-right:auto;
      padding: 20px;
    }
    [data-view="report"] h2{ font-size:22px; line-height:1.25; }

    [data-view="report"] form{ gap:12px; }
    [data-view="report"] .field{ gap:6px; }
    [data-view="report"] .field label{
      font-size: clamp(16px, 1.2vw, 18px);
      line-height:1.3;
    }
    [data-view="report"] .field input,
    [data-view="report"] .field select,
    [data-view="report"] .field textarea{
      font-size:15px;
      padding:10px 12px;
    }
    [data-view="report"] .field textarea{ min-height: 90px; }
    [data-view="report"] .field small{ font-size:13px; }
    [data-view="report"] .field[data-step]{ padding-left:52px; }
    [data-view="report"] .field[data-step]::before{
      left:16px; width:28px; height:28px; font-size:13px;
    }

    @media (max-width: 640px){
      [data-view="report"] .field label{ font-size:18px; }
      [data-view="report"] .field input,
      [data-view="report"] .field select,
      [data-view="report"] .field textarea{ font-size:16px; }
      .btn small{ font-size:15px; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <button class="back" aria-label="‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö" onclick="go('home')">‚üµ</button>
    <h1 id="title">Maintenance</h1>
  </div>

  <main class="container">
    <!-- HOME -->
    <section data-view="home" class="active">
      <div class="hero"><span>Maintenance</span></div>
      <img class="big-img" alt="illustration" src="" onerror="this.remove()" />

      <div class="menu">
        <button class="btn" onclick="go('report')">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° <small>Repair request</small></button>
        <button class="btn" onclick="go('status')">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° <small>Request status</small></button>
        <button class="btn" onclick="go('powerbi')">Power BI <small>Dashboard</small></button>
        <button class="btn" onclick="go('guide')">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô <small>User guide</small></button>
      </div>
    </section>

    <!-- REPORT -->
    <section data-view="report">
      <div class="card">
        <h2 style="margin:0 0 8px">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (Repair Request)</h2>

        <form id="ticketForm">
          <div class="field" data-step="1">
            <label for="assigned">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á (Requestor Name)</label>
            <input id="assigned" name="assigned" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ / e.g. Somchai" required />
          </div>

          <div class="field" data-step="2">
            <label for="dept">Machine Section</label>
            <select id="dept" name="dept" required>
              <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å... / Select...</option>
              <option>P3/1</option>
              <option>P3/2</option>
              <option>P3/3</option>
              <option>P4/1</option>
            </select>
          </div>

          <div class="field" data-step="3">
            <label for="machine">Machine</label>
            <input id="machine" name="machine" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏î... / e.g. Cutting machine" required />
          </div>

          <div class="field" data-step="4">
            <label for="desc">Repairdescription</label>
            <textarea id="desc" name="desc" placeholder="‡πÄ‡∏•‡πà‡∏≤‡∏≠‡∏≤‡∏Å‡∏≤‡∏£/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏û‡∏ö (Describe problem / location / condition)" required></textarea>
          </div>

          <div class="field" data-step="5">
            <label for="preorder">Pre order</label>
            <input id="preorder" name="preorder" type="text" placeholder="‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å (Optional)" />
            <small>‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ</small>
          </div>

          <div class="field" data-step="6">
            <label for="department">Department</label>
            <select id="department" name="department" required>
              <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å... / Select...</option>
              <option>Mechanical</option>
              <option>Electrical</option>
              <option>Mold</option>
              <option>PM</option>
            </select>
          </div>

          <div class="field" data-step="7">
            <label for="supervisor">Supervisor</label>
            <input id="supervisor" name="supervisor" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à (Optional)" />
            <small>‡∏£‡∏∞‡∏ö‡∏∏‡∏ñ‡πâ‡∏≤‡∏ó‡∏£‡∏≤‡∏ö (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) / Optional field</small>
          </div>

          <div class="field" data-step="8">
            <label for="assignedTo">Assigned</label>
            <input id="assignedTo" name="assignedTo" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≤‡∏á/‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (Optional)" />
            <small>‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ</small>
          </div>

          <button class="btn" type="submit">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ã‡πà‡∏≠‡∏° <small>Submit request</small></button>
        </form>

        <p class="muted" style="margin-top:10px">
          *‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:* ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á <code>RequestDate</code> ‡πÅ‡∏•‡∏∞ <code>TimeREquest</code> ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        </p>
      </div>
    </section>

    <!-- SUCCESS -->
    <section data-view="success">
      <div class="card" style="text-align:center">
        <h2>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (Request Submitted)</h2>
        <p class="muted">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß / Your request has been recorded.</p>
        <div style="display:flex; gap:10px; justify-content:center; margin-top:14px; flex-wrap:wrap">
          <button class="chip" onclick="go('status')">‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞<br><small>View status</small></button>
          <button class="chip" onclick="go('home')">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å<br><small>Back to home</small></button>
        </div>
      </div>
    </section>

    <!-- STATUS -->
    <section data-view="status">
      <div class="kpi">
        <div class="box"><b>Scheduled</b><span id="kScheduled">0</span></div>
        <div class="box"><b>Completed</b><span id="kCompleted">0</span></div>
        <div class="box"><b>Overdue</b><span id="kOverdue">0</span></div>
      </div>

      <div class="card">
        <h3 style="margin-top:0; font-size:20px">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠ (Request List)</h3>
        <table id="tbl">
          <thead>
            <tr>
              <th>Date</th>
              <th>Department</th>
              <th>Machine</th>
              <th>Description</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <p class="muted" style="margin:12px 0 0">
          *‡∏Å‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö Scheduled ‚Üí Completed ‚Üí Overdue / Click status to toggle
        </p>
      </div>
    </section>

    <!-- POWER BI -->
    <section data-view="powerbi">
      <div class="card">
        <h2 style="margin:0 0 12px">Power BI Dashboard</h2>
        <p class="muted">‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Embed ‡∏Ç‡∏≠‡∏á Power BI ‡πÅ‡∏ó‡∏ô <code>IFRAME</code> ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ / Replace src with your Power BI embed link.</p>

        <div style="display:grid; gap:14px">
          <iframe title="Overview"
            style="width:100%; aspect-ratio:16/9; border:0; background:#fafafa"
            src="https://app.powerbi.com/view?r=eyJrIjoiYWM2MDViNTEtNGU4Mi00ODVlLTk4ZmItMzgzMTg1YzdjNDUxIiwidCI6ImY5MGM0NjQ3LTg4NmYtNGI0Yy1iMmViLTU1NWRmOWVjNGU4MSIsImMiOjEwfQ%3D%3D"
            allowfullscreen></iframe>

          <iframe title="Maintenance Wise"
            style="width:100%; aspect-ratio:16/9; border:0; background:#fafafa"
            src="https://app.powerbi.com/view?r=eyJrIjoiYWM2MDViNTEtNGU4Mi00ODVlLTk4ZmItMzgzMTg1YzdjNDUxIiwidCI6ImY5MGM0NjQ3LTg4NmYtNGI0Yy1iMmViLTU1NWRmOWVjNGU4MSIsImMiOjEwfQ%3D%3D"
            allowfullscreen></iframe>
        </div>
      </div>
    </section>

    <!-- PM -->
    <section data-view="pm">
      <div class="card">
        <h2 style="margin:0 0 10px">Dashboard : Preventive Maintenance</h2>
        <p>‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô (Preventive Maintenance) ‚Ä¶</p>
        <ul>
          <li>PM Compliance %, Breakdown hrs, MTBF/MTTR</li>
          <li>‡πÅ‡∏ú‡∏ô PM ‡∏£‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</li>
          <li>Top Risks ‡∏à‡∏≤‡∏Å FMEA ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏™‡∏µ‡∏¢</li>
        </ul>
      </div>
    </section>

    <!-- GUIDE -->
    <section data-view="guide">
      <div class="card">
        <h2 style="margin:0 0 10px">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (User Guide)</h2>
        <ol>
          <li>‡∏Å‡∏î ‚Äú‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (Repair request)‚Äù ‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏™‡πà‡∏á</li>
          <li>‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÉ‡∏ô ‚Äú‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (Request status)‚Äù</li>
          <li>‡∏ù‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô ‚ÄúPower BI Dashboard‚Äù ‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏¥‡∏á‡∏Å‡πå Embed</li>
          <li>‡∏õ‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏Å/‡∏ä‡∏ô‡∏¥‡∏î‡∏á‡∏≤‡∏ô/‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°</li>
        </ol>
        <p class="muted">*‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Single-File HTML ‚Äî ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡∏∂‡πâ‡∏ô Google Drive/‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
      </div>
    </section>
  </main>

  <!-- Mobile tabbar -->
  <div class="tabbar">
    <div class="inner">
      <button class="chip" onclick="go('home')">Home<br><small>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</small></button>
      <button class="chip" onclick="go('report')">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°<br><small>Repair</small></button>
      <button class="chip" onclick="go('status')">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞<br><small>Status</small></button>
      <button class="chip" onclick="go('powerbi')">Power BI<br><small>Dashboard</small></button>
      <button class="chip" onclick="go('guide')">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠<br><small>Guide</small></button>
    </div>
  </div>

  <script>
    /* ===== Config ===== */
    const APP_NAME    = 'Centralized Database from factory';
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxoGPh-Q175O0rfbm0tA8B6tjb5TSvVgPxmuZ0CqI79wUP8zuEqbBWsJj5sYPTdiQaljA/exec';
    const API_TOKEN   = '0992183266';

    /* ===== Router ===== */
    const titleMap = {
      home:"Maintenance",
      report:"‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°",
      success:"‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°",
      status:"‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°",
      powerbi:"Power BI",
      pm:"Preventive Maintenance",
      guide:"‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
    };

    function show(view){
      document.querySelectorAll('[data-view]').forEach(el=>el.classList.remove('active'));
      const el = document.querySelector(`[data-view="${view}"]`);
      if (el) el.classList.add('active');

      document.getElementById('title').textContent = titleMap[view] || 'Maintenance';
      document.title = `${titleMap[view] || 'Maintenance'} ¬∑ ${APP_NAME}`;
      history.replaceState(null, '', `#${view}`);
      window.scrollTo({top:0, behavior:'smooth'});

      if(view === 'status') renderTable();
    }
    function go(view){ show(view); }

    window.addEventListener('load', () => {
      const initial = (location.hash || '#home').slice(1);
      show(initial);
    });

    /* ===== Local fallback (demo) ===== */
    const DEMO = !/^https?:\/\//i.test(WEB_APP_URL);
    const KEY='tickets.v2';
    const getTickets=()=>JSON.parse(localStorage.getItem(KEY)||'[]');
    const setTickets=(v)=>localStorage.setItem(KEY,JSON.stringify(v));

    /* ===== API helpers ===== */
    async function fetchJSON(url, options){
      const res = await fetch(url, options);
      const text = await res.text();
      try{ return JSON.parse(text); }
      catch(e){ throw new Error(`Bad response (${res.status}): ${text.slice(0,200)}`); }
    }

    async function apiCreateTicket(payload){
      const body = new URLSearchParams({ action:'create', token: API_TOKEN, ...payload }).toString();
      return fetchJSON(WEB_APP_URL, {
        method:'POST',
        headers:{'Content-Type':'application/x-www-form-urlencoded'},
        body
      });
    }

    async function apiListTickets(limit=500){
      return fetchJSON(`${WEB_APP_URL}?action=list&limit=${limit}`);
    }

    async function apiUpdateStatus(id, status){
      const body = new URLSearchParams({ action:'updateStatus', id, status, token: API_TOKEN }).toString();
      return fetchJSON(WEB_APP_URL, {
        method:'POST',
        headers:{'Content-Type':'application/x-www-form-urlencoded'},
        body
      });
    }

    /* ===== Submit form ===== */
    document.getElementById('ticketForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target).entries());

      const now = new Date();
      const RequestDate = now.toLocaleDateString('en-CA');
      const TimeREquest = now.toTimeString().slice(0,5);

      const payload = {
        RequestDate,
        TimeREquest,
        "Machine Section": data.dept || '',
        Machine: data.machine || '',
        Repairdescription: data.desc || '',
        "Pre order": data.preorder || '',
        Assigned: data.assignedTo || '',
        Department: data.department || '',
        Supervisor: data.supervisor || '',
        "Work Order No.": '',
        "Time to repair": '',
        ScgeduldedDate: '',
        Status: 'Scheduled',
        Recorder: data.assigned || ''
      };

      try{
        if(DEMO){
          const ticket = {
            id: Date.now().toString(36),
            date: RequestDate,
            dept: data.dept,
            machine: data.machine,
            desc: data.desc,
            status: 'Scheduled'
          };
          const all = getTickets();
          all.unshift(ticket);
          setTickets(all);
          e.target.reset();
          go('success');
        } else {
          const r = await apiCreateTicket(payload);
          if(r.ok){
            e.target.reset();
            go('success');
          } else {
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (r.error || 'unknown'));
          }
        }
      } catch(err){
        alert('‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
      }
    });

    /* ===== Render table ===== */
    async function renderTable(){
      const tbody = document.querySelector('#tbl tbody');
      tbody.innerHTML = DEMO ? '' : '<tr><td colspan="5">Loading...</td></tr>';

      let rows = [];
      if(DEMO){
        rows = getTickets();
      } else {
        try{
          const r = await apiListTickets(500);
          rows = (r.rows||[]).map(x=>({
            id: x['ID'] || x['id'] || '',
            date: x['RequestDate'] || x['Request Date'] || '',
            dept: x['Machine Section'] || x['Machine Department'] || '',
            machine: x['Machine'] || x['Machine Name'] || '',
            desc: x['Repairdescription'] || x['Problem Description'] || '',
            status: x['Status'] || 'Scheduled'
          }));
        } catch(e){
          tbody.innerHTML = '<tr><td colspan="5">Load failed</td></tr>';
          return;
        }
      }

      let s=0,c=0,o=0;
      tbody.innerHTML='';
      for(const r of rows){
        if(r.status==='Scheduled') s++;
        else if(r.status==='Completed') c++;
        else o++;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${escapeHtml(r.date||'')}</td>
          <td>${escapeHtml(r.dept||'')}</td>
          <td>${escapeHtml(r.machine||'')}</td>
          <td>${escapeHtml(r.desc||'')}</td>
          <td><button class="chip" data-id="${escapeHtml(r.id||'')}" data-status="${escapeHtml(r.status)}">${escapeHtml(r.status)}</button></td>
        `;
        tbody.appendChild(tr);
      }
      document.getElementById('kScheduled').textContent=s;
      document.getElementById('kCompleted').textContent=c;
      document.getElementById('kOverdue').textContent=o;
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }

    /* ===== Toggle status ===== */
    document.addEventListener('click', async (ev)=>{
      const btn = ev.target.closest('button.chip[data-id]');
      if(!btn) return;

      const cycle = { 'Scheduled':'Completed', 'Completed':'Overdue', 'Overdue':'Scheduled' };
      const id = btn.getAttribute('data-id');
      const next = cycle[btn.dataset.status] || 'Scheduled';

      if(DEMO){
        const all = getTickets();
        const t = all.find(x=>x.id===id);
        if(t){
          t.status = next;
          setTickets(all);
          renderTable();
        }
      } else {
        try{
          const r = await apiUpdateStatus(id, next);
          if(r.ok) renderTable();
          else alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        } catch(err){
          alert('‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
        }
      }
    });
  </script>
</body>
</html>


